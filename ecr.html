<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">  -->
    <title>Ecr Client by Novidea</title>
    <style>
      body {
        background-image: url("https://dimcost42.github.io/Front-End/saasBackground.jpg");
        /* background-position: center; */
        background-repeat: no-repeat;
        background-size: 100%;
        margin: 0;
        font-family: Arial, Helvetica, sans-serif;
      }

      #mytDiv {
        background-color: aliceblue;
        opacity: 85%;
        width: 30%;
        padding: 2%;
      }

      .topnav {
        overflow: hidden;
        background-color: aliceblue;
        opacity: 85%;
      }

      .topnav a {
        float: left;
        color: #080808;
        text-align: center;
        padding: 14px 16px;
        text-decoration: none;

        font-size: 17px;
      }

      .topnav a:hover {
        background-color: #ddd;
        color: black;
      }

      .topnav a.active {
        background-color: #020202;
        color: white;
      }

      /* #logo {
    position: fixed;
    bottom: 0;
} */
    </style>
  </head>
  <body>
    <div class="topnav">
      <a class="active" href="#home">Home</a>
      <a
        href="https://docs.google.com/document/d/1KVT2fHWkUQEXx1snAYc-2BH0IqSpzBQCNo_WEdvyJSc/edit?usp=sharing"
        target="_blank"
        >Examples</a
      >
      <a
        href="https://docs.google.com/document/d/1n95uLwv13Avk4Kb4yDWeiiGi25b1mD-KN0O94x42oOo/edit?usp=sharing"
        target="_blank"
        >Run Ecr as a service</a
      >
      <a
        href="https://drive.google.com/file/d/1zzjd6Eh2vlxmsOuiLDTxWKXrDURoCaFj/view?usp=sharing"
        target="_blank"
        >Rest Api Download</a
      >
      <a
        href="https://drive.google.com/file/d/1y3zbr1bJcPHD11dImBE4KQUw88_VWzhH/view?usp=sharing"
        target="_blank"
        >JDK 11.0.11</a
      >
      
      <a
        href="https://drive.google.com/file/d/17HQqiDBmsHzOT9AI3L2qjApRhGq3moNO/view?usp=sharing"
        target="_blank"
        >installwinsrv_x64.bat</a
      >
      <a
        href="https://drive.google.com/file/d/1tOXfKXvyCjXvAR6wR01IX0Z6kBVsuXLU/view?usp=sharing"
        target="_blank"
        >application.properties</a
      >
    </div>
    <center>
      <div id="mytDiv">
        <h1>Ecr2Eft Web Client</h1>
        <input
          type="radio"
          id="sale"
          name="saleType"
          value="sale"
          checked
          onclick="manipulateInputs(true, false, true, true)"
        />
        <label for="sale">Sale</label>
        <br />

        <input
          type="radio"
          id="saleinstallments"
          name="saleType"
          value="sale"
          onclick="manipulateInputs(true, false, false, true)"
        />
        <label for="saleinstallments">Sale with installements</label>
        <br />

        <input
          type="radio"
          id="fullvoid"
          name="saleType"
          value="fullvoid"
          onclick="manipulateInputs(false, false, true, true)"
        />
        <label for="fullvoid">FullVoid</label>
        <br />

        <input
          type="radio"
          id="refund"
          name="saleType"
          value="refund"
          onclick="manipulateInputs(false, false, true, true)"
        />
        <label for="refund">Refund</label>
        <br />

        <input
          type="radio"
          id="loyaltyvoid"
          name="saleType"
          value="loyaltyvoid"
          onclick="manipulateInputs(false, false, true, true)"
        />
        <label for="loyaltyvoid">Loyalty Void</label>
        <br />

        <input
          type="radio"
          id="freerefund"
          name="saleType"
          value="refund"
          onclick="manipulateInputs(true, false, true, true)"
        />
        <label for="freerefund">Free Refund</label>
        <br />

        <input
          type="radio"
          id="merchantinfo"
          name="saleType"
          value="merchantinfo"
          onclick="manipulateInputs(true, true, true, true)"
        />
        <label for="merchantinfo">Merchant Info</label>
        <br />


        <input
        type="radio"
        id="normalpreauth"
        name="saleType"
        value="normalpreauth"
        onclick="manipulateInputs(true, false, true, true)"
      />
      <label for="normalpreauth">Pre Auth</label>
      <br />

      <input
          type="radio"
          id="preauthcompletion"
          name="saleType"
          value="preauthcompletion"
          onclick="manipulateInputs(false, false, true, false)"
        />
        <label for="preauthcompletion">Pre Auth Completion</label>
        <br />

        <input
          type="radio"
          id="reconciliation"
          name="saleType"
          value="reconciliation"
          onclick="manipulateInputs(true, true, true, true)"
        />
        <label for="reconciliation">Reconciliation</label>
        <br />
      

        <br /><br />
        <label for="url">Service Url</label><br />
        <input
          type="text"
          id="url"
          title="url"
          value="http://localhost:8080"
        /><br /><br />
        <label for="ip">Pos IP</label><br />
        <input type="text" id="ip" title="ip" value="192.168.1.1" /><br /><br />
        <label for="port">Pos Port</label><br />
        <input type="text" id="port" title="ip" value="4000" /><br /><br />
        <label for="tid">Terminal ID</label><br />
        <input type="text" id="tid" title="tid" value="77000000" /><br /><br />
        <label for="amount" id="amountlbl">Amount</label><br />
        <input
          type="text"
          id="amount"
          title="amount"
          value="01.00"
        /><br /><br />
        <label for="rrn" id="rrnlbl">RRN</label><br />
        <input type="text" id="rrn" title="rrn" value="001001" /><br /><br />

        <label for="installements" id="installementslbl">Installements</label
        ><br />
        <select id="installements">
          <option disabled>Number of installements</option>
          <option value="002">2</option>
          <option value="003">3</option>
          <option value="004">4</option>
          <option value="005">5</option>
          <option value="006">6</option>
          <option value="007">7</option>
          <option value="008">8</option>
          <option value="009">9</option>
          <option value="010">10</option>
          <option value="011">11</option>
          <option value="012">12</option>
        </select>
        <br/><br/>
        <label for="authorizationCode" id="authorizationCodelbl">Authorization Code</label><br />
        <input type="text" id="authorizationCode" title="authorizationCode" value="001001" /><br /><br />
        <br /><br />

        <br />
        <button type="button" onclick="loadDoc()">Request data</button>
        <b>
          <pre id="demo"></pre>
        </b><br/>
        <pre id="latestrequest"></pre>

        <a href="https://www.novidea.gr/" target="_blank"
          ><img
            id="logo"
            src="https://www.novidea.gr/img/novidea-logo.svg"
            width="200dp"
        /></a>

      </div>
    </center>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        manipulateInputs(true, false, true, true);
      });

      function manipulateInputs(hideRRNenabled, hideAmountEnabled, hideInstallementsEnabled, authorizationCodeEnabled) {
        document.getElementById("rrn").hidden = hideRRNenabled;
        document.getElementById("rrnlbl").hidden = hideRRNenabled;
        document.getElementById("amount").hidden = hideAmountEnabled;
        document.getElementById("amountlbl").hidden = hideAmountEnabled;
        document.getElementById("installements").hidden = hideInstallementsEnabled;
        document.getElementById("installementslbl").hidden = hideInstallementsEnabled;
        document.getElementById("authorizationCodelbl").hidden = authorizationCodeEnabled;
        document.getElementById("authorizationCode").hidden = authorizationCodeEnabled;
      }

      function loadDoc() {
        var xhttp = new XMLHttpRequest();
        
        var radioButtonAttribute = document.querySelector(
          'input[name="saleType"]:checked'
        );
        var radioButtonCheckedValue = radioButtonAttribute.value;
        var raddioButtonCheckedID = radioButtonAttribute.id;

        xhttp.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            var jsonResponse = JSON.parse(this.responseText);
            document.getElementById("demo").innerHTML = "RESPONSE:<br/><br/>"+JSON.stringify(
              jsonResponse,
              null,
              2
            );
            if(jsonResponse.transactionData.referenceNumber != null){
            document.getElementById("rrn").value = jsonResponse.transactionData.referenceNumber;
            }
            if(jsonResponse.transactionData.authorizationCode != null){
            document.getElementById("authorizationCode").value = jsonResponse.transactionData.authorizationCode;
            }
            if(jsonResponse.transactionData.eftTerminalId != null){
            document.getElementById("tid").value = jsonResponse.transactionData.eftTerminalId;
            }
          }
        };
        xhttp.open(
          "POST",
          document.getElementById("url").value + "/" + radioButtonCheckedValue,
          true
        );
        xhttp.setRequestHeader("Content-type", "application/json");

        if (raddioButtonCheckedID === "saleinstallments") {
          var jsonObject = JSON.stringify({
            serviceData: {
              host: "" + document.getElementById("ip").value + "",
              port: "" + document.getElementById("port").value + "",
              ecrid: "" + document.getElementById("tid").value + ""
            },
            transactionData: {
              firstByteOriginalTrans: "0",
              uniqueTxnId: "                   " + Date.now(),
              amount: "" + document.getElementById("amount").value + "",
              tlvData:
                "TL0007NI03" +
                document.getElementById("installements").options[
                  document.getElementById("installements").selectedIndex
                ].value,
            },
          });
        }

        if (
          radioButtonCheckedValue === "sale" &&
          raddioButtonCheckedID !== "saleinstallments"
        ) {
          var jsonObject = JSON.stringify({
            serviceData: {
              host: "" + document.getElementById("ip").value + "",
              port: "" + document.getElementById("port").value + "",
              ecrid: "" + document.getElementById("tid").value + ""
            },
            transactionData: {
              firstByteOriginalTrans: "0",
              uniqueTxnId: "                   " + Date.now(),
              amount: "" + document.getElementById("amount").value + "",
            },
          });
        }

        if (
          radioButtonCheckedValue === "normalpreauth" &&
          raddioButtonCheckedID !== "saleinstallments"
        ) {
          var jsonObject = JSON.stringify({
            serviceData: {
              host: "" + document.getElementById("ip").value + "",
              port: "" + document.getElementById("port").value + "",
              ecrid: "" + document.getElementById("tid").value + ""
            },
            transactionData: {
              uniqueTxnId: "                   " + Date.now(),
              amount: "" + document.getElementById("amount").value + "",
            },
          });
        }
        
        if (radioButtonCheckedValue === "merchantinfo") {
          var jsonObject = JSON.stringify({
            serviceData: {
              host: "" + document.getElementById("ip").value + "",
              port: "" + document.getElementById("port").value + "",
              ecrid: "" + document.getElementById("tid").value + ""
            },
            transactionData: {}
          });
        }

        if (radioButtonCheckedValue === "fullvoid") {
          var jsonObject = JSON.stringify({
            serviceData: {
              host: "" + document.getElementById("ip").value + "",
              port: "" + document.getElementById("port").value + "",
              ecrid: "" + document.getElementById("tid").value + ""
            },
            transactionData: {
              firstByteOriginalTrans: "0",
              uniqueTxnId: "                   " + Date.now(),
              amount: "" + document.getElementById("amount").value + "",
              referenceNumber: "" + document.getElementById("rrn").value + "",
            },
          });
        }

        if (radioButtonCheckedValue === "preauthcompletion") {
          var jsonObject = JSON.stringify({
            serviceData: {
              host: "" + document.getElementById("ip").value + "",
              port: "" + document.getElementById("port").value + "",
              ecrid: "" + document.getElementById("tid").value + ""
            },
            transactionData: {
              uniqueTxnId: "                   " + Date.now(),
              amount: "" + document.getElementById("amount").value + "",
              referenceNumber: "" + document.getElementById("rrn").value + "",
              authorizationCode: "" + document.getElementById("authorizationCode").value + ""
            },
          });
        }

        if (radioButtonCheckedValue === "reconciliation") {
          jsonObject = JSON.stringify({
            serviceData: {
              host: "" + document.getElementById("ip").value + "",
              port: "" + document.getElementById("port").value + "",
              ecrid: "" + document.getElementById("tid").value + ""
            },
            transactionData: {
              firstByteOriginalTrans: "0",
              uniqueTxnId: "                   " + Date.now(),
              reconciliationMode: "0",
              batchNumber: "000000",
            },
          });
        }

        if (radioButtonCheckedValue === "refund") {
          jsonObject = JSON.stringify({
            serviceData: {
              host: "" + document.getElementById("ip").value + "",
              port: "" + document.getElementById("port").value + "",
              ecrid: "" + document.getElementById("tid").value + ""
            },
            transactionData: {
              firstByteOriginalTrans: "0",
              uniqueTxnId: "                   " + Date.now(),
              amount: "" + document.getElementById("amount").value + "",
              tlvData: "TL0010OR06" + document.getElementById("rrn").value + "",
            },
          });
        }

        
        if (radioButtonCheckedValue === "loyaltyvoid") {
          jsonObject = JSON.stringify({
            serviceData: {
              host: "" + document.getElementById("ip").value + "",
              port: "" + document.getElementById("port").value + "",
              ecrid: "" + document.getElementById("tid").value + ""
            },
            transactionData: {
              firstByteOriginalTrans: "0",
              uniqueTxnId: "                   " + Date.now(),
              amount: "" + document.getElementById("amount").value + "",
              referenceNumber: "" + document.getElementById("rrn").value + ""
            },
          });
        }

        if (
          document.querySelector('input[name="saleType"]:checked').id ===
          "freerefund"
        ) {
          jsonObject = JSON.stringify({
            serviceData: {
              host: "" + document.getElementById("ip").value + "",
              port: "" + document.getElementById("port").value + "",
              ecrid: "" + document.getElementById("tid").value + ""
            },
            transactionData: {
              firstByteOriginalTrans: "0",
              uniqueTxnId: "                   " + Date.now(),
              amount: "" + document.getElementById("amount").value + "",
            },
          });
        }

        console.log(jsonObject);
        xhttp.send(jsonObject);

        document.getElementById("demo").innerHTML =
          "<img src='https://dimcost42.github.io/Front-End/cd514331234507.564a1d2324e4e.gif' width='300'/><br/>" +
          radioButtonCheckedValue +
          " request...<br/><br/>" 
          

          document.getElementById("latestrequest").innerHTML = "<br/>REQUEST:<br/><br/>"+"POST " +
          document.getElementById("url").value +
          "/" +
          radioButtonCheckedValue +
          "<br/><br/>" +
          JSON.stringify(JSON.parse(jsonObject), null, 2);
      }

      function create_UUID() {
        var dt = new Date().getTime();
        var uuid = "xxxxxxxxxxxx4xxxxxxyxxxxxxxxxxxx".replace(
          /[xy]/g,
          function (c) {
            var r = (dt + Math.random() * 16) % 16 | 0;
            dt = Math.floor(dt / 16);
            return (c == "x" ? r : (r & 0x3) | 0x8).toString(16);
          }
        );
        return uuid;
      }
    </script>
  </body>
</html>
